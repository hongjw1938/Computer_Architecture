### 버스 중재
- 병렬 중재 방식
  - 우선순위의 결정 방식에 따른 분류
    - 고정 우선순위 방식(fixed-priority scheme) : 각 버스 마스터에 저장된 우선순위가 고정되어 있는 방식
      - 중앙 집중식 고정 우선순위 중재 방식
        - 모든 버스 마스터들이 버스 중재기에 접속
        - 중재기와 가장 가까이 위치한 버스 마스터 1이 가장 높은 우선순위, 4가 가장 낮음
        - ![Alt text](/images/15-0.png)
          - 1이 사용중일때, 3이 요청하면 마스터 3이 BREQ3신호 세트
          - 중재기가 3에게 BGNT3 신호를 세트해 사용 허가
          - 마스터 1이 사용 끝내고 BBUSY 신호 해제
          - 마스터 3이 BBUSY 신호를 다시 세트하고 버스 사용. BREQ, BGNT는 제거됨
        - ![Alt text](/images/15-1.png)
          - 즉, 가장 위가 우선순위 높고 그 아래들은 우선 순위 높은 것이 사용중이 아닌 경우에 가능하도록 AND연산
      - 분산식 고정 우선순위 방식(잘 사용되지 않음)
        - 모든 버스 마스터들이 중재기를 한 개씩 보유
        - 중재 동작
          - 각 중재기는 자신보다 더 높은 우선순위를 가진 마스터들의 버스 요구 신호들을 받아서 검사하여, 그들이 버스 사용 요구를 하지 않은 경우에만 자신의 버스 마스터로 버스 승인 신호 발생
          - 승인 신호를 받으면 BBUSY 신호를 검사해서 해제된 상태이면 버스 사용 시작
        - 장점
          - 중앙집중식에 비해 중재 회로가 간단, 동작 속도 빠름
        - 단점
          - 고장을 일으킨 중재기를 찾아내는 방법이 복잡, 한 중재기의 고장이 전체 시스템의 동작에 영향을 일으킴
        - ![Alt text](/images/15-2.png)
    - 가변 우선순위 방식(dynamic-priority scheme) : 우선순위를 변경할 수 있는 방식
      - 시스템의 상태에 따라 각 버스 마스터들의 우선순위를 계속 변화시키는 방식
      - 단점 : 중재 회로 복잡 / 장점 : 모든 마스터들이 공정하게 버스 사용
      - 회전 우선 순위(rotating priority) 방식
        - 중재 동작이 끝날 때마다 모든 마스터들의 우선순위가 한 단계식 낮아지고, 가장 우선순위가 낮았던 마스터가 최상위 우선순위를 가지도록 함
        - 일단 버스 사용 승인을 받은 마스터는 최하위 우선순위를 가지며, 바로 다음 위치한 마스터가 최상위 우선순위를 가지도록 함 - Acceptance-dependent식 회전 우선순위 방식
        - ![Alt text](/images/15-3.png)
      - 임의 우선순위 방식
        - 각 중재 동작이 끝날 때마다 우선순위 임의 결정
      - 동등 우선순위 방식
        - 모든 마스터들이 동등한 우선순위를 가지며, FIFO 알고리즘 사용
      - 최소 최근 사용(LRU)
        - 최근 가장 버스를 오래 사용하지 않은 버스 마스터에 최상위 우선순위
        - 단점 : 회로 복잡
- 직렬 중재 방식
  - 중앙집중식 직렬 중재 방식
    - 하나의 중재 신호선(BGNT)이 데이지 체인 형태로 모든 버스 마스터들을 직렬로 연결
    - 우선순위는 버스 승인 신호선이 연결된 순서대로 결정
    - 동작원리
      - 한 개 또는 그 이상의 버스 마스터가 버스 사용 요구시 공통의 BREQ 신호 세트(누가 요구했는지 모름)
      - 버스 중재기 : 데이지 체인의 첫 번째에 접속된 마스터로 승인 신호(BGNT) 전송
      - BGNT 신호를 받은 마스터는 만약 버스 사용을 요구한 상태면, 버스 사용권 가짐.
      - USB방식이 이와 비슷
      - 만약 버스 사용 요구 않했다면, 승인 신호를 다음 마스터로 통과
      - 승인 신호는 버스를 요구한 마스터에게 도달시까지 계속 통과
      - 여러개가 요청이 가장 중재기에 가까이 위치한 마스터가 버스 사용권 획득
      - ![Alt text](/images/15-4.png)
      - 문제는 계속해서 중간에서 요청해 버리면 뒤에 있는 것들이 버스를 사용하지 못하는 문제가 됨.(그래서 방식이 많이 바뀜)
  - 분산식 직렬 중재 방식(별로 좋지 않은 방식)
    - 구성
      - 데이지 체인 승인 신호(DBGNT)가 버스 중재기들을 순환형으로 접속
    - 동작 원리
      - 버스 사용권을 부여 받은 마스터가 버스 사용을 시작하는 순간에 DBGNT 신호를 세트하여 자신의 바로 우측에 연결된 마스터의 중재기로 전송
      - 만약 그 마스터가 버스 사용을 신청하고 기다리던 중이었다면, 중재기는 즉시 DBGNT 신호를 받아들여서 BGNT 신호를 발생시켜 마스터로 전송
      - DBGNT 신호를 받은 마스터가 버스 요구를 하지 않은 상태면, 그 신호를 우측의 다음 중재기로 통과, 그러한 과정은 버스를 요구한 마스터에 도달 시까지 반복
      - ![Alt text](/images/15-5.png)
    - 특징
      - 각 마스터의 우선순위가 계속 변화함
      - 버스 사용 승인을 받으면 다음 중재 동작에서는 최하위 우선순위
      - 버스 사용한 마스터의 바로 우측 위치 마스터가 최상위 우선순위
      - 순환형 구조에서 DBGNT 신호가 연결된 순서로 우선순위 하나씩 감소
    - 단점 : 어느 한 지점 결함시 전체 시스템 중단;;
- 폴링 방식
  - Polling scheme 의 원리
    - 버스 사용을 원하는 마스터가 있는지 버스 중재기가 주기적으로 검사하여 사용 승인 여부 결정(즉, 중재기가 마스터들에게 물어보는 것이다. 각각 찾아서)
  - 하드웨어 폴링 방식
    - 버스 중재기와 각 버스 마스터 간에 별도의 폴링 선이 존재
    - 2진 코드화된 폴링 주소를 이용시, 폴링 선의 수가 log2N 개로 감소
    - 공통의 BREQ선과 BBUSY 선이 각각 한 개씩 존재
    - 동작 순서
      - 중재기는 폴링 주소를 발생해서 검사할 마스터 지정후, 그 마스터가 버스 사용을 원하는지 묻는다.
      - 마스터가 원하면 BREQ 신호 세트
      - 세트되면, 중재기는 현재 검사 중인 마스터에게 버스 사용을 허가하고, 아니면 다음 마스터에 대한 검사 순서대로 진행
    - 우선순위 결정 방법
      - 중재기가 마스터를 검사하는 순서에 의함. 검사할 마스터의 번호는 2진 카운터 이용해 발생(간단하게 순서대로)
    - ![Alt text](/images/15-6.png)
      - 8개의 버스 마스터면 3개의 폴링 주소선 필요한 것.
      - BGNT는 필요 없고 BREQ를 보내고 마스터가 바로 BBUSY 보냄
      - 근데 문제는, 딱 정해진 주소선 개수만큼만 마스터를 연결할 수 있다는 단점이 생겨 융통성이 결여된다. 또한 속도가 떨어질 수 있음. 그러나 IO처럼 속도가 느린 장치에 대해서는 아주 좋은 방법이다.
  - 소프트웨어 폴링 방식
    - 동작 원리
      - 폴링의 순서와 과정을 버스 중재기내의 프로세서가 관장
    - 단점
      - 프로그램을 실행해야 하므로 하드웨어 방식에 비해 속도가 더 느림
    - 장점
      - 우선순위의 변경 용이
    - 실제 시스템에서는 사실 거의 사용치 않는다..
    - 자동 제어 시스템 등에서 사용되기도 한다.
