### 캐시 기억장치
- 교체알고리즘
  - 세트-연관 사상에서 사용됨.
  - 주기억장치로부터 새로운 블록이 캐시로 적재될 때, 세트 내 모든 라인이 다른 블록으로 채워져 있다면, 그들 중의 하나를 선택해 새로운 블록으로 교체
  - 알고리즘 : 캐시 적중률 극대화할 수 있도록 교체할 블록을 선택하기 위한 알고리즘
    - 최소 최근 사용(Least Recently Used : LRU)
      - 사용되지 않은 채로 가장 오래 있었던 블록을 교체하는 방식
      - ![Alt text](/images/9-2-0.png)
    - FIFO(First-in-First-out)
      - 캐시에 적재된 지 가장 오래된 블록을 교체
    - 최소 사용 빈도(Least Frequently Used: LFU)
      - 참조되었던 횟수가 가장 적은 블록 교체
- 쓰기 정책(write policy)
  - 캐시의 블록이 변경되었을 때 그 내용을 주기억장치에 갱신하는 시기와 방법 결정
  - 종류
    - write-through : 모든 쓰기 동작들이 캐시로 뿐만 아니라 주기억장치로도 동시에 수행되는 방식
      - 장점 : 캐시에 적재된 블록의 내용과 주기억장치의 블록 내용이 일치
      - 단점 : 모든 쓰기 동작이 주기억장치 쓰기를 포함하여, 시간이 길어짐.
    - write-back : 캐시에서 데이터가 변경되어도 주기억장치에는 갱신되지 않는 방식
      - 장점 : 기억장치에 대한 쓰기 동작의 횟수가 최소화되고, 쓰기 시간이 짧아짐
      - 단점 : 캐시의 내용과 주기억장치 내용이 불일치
        - 블록 교체시에는 캐시의 상태를 확인해 갱신하는 동작이 선행되어야 하고, 그를 위해 각 캐시 라인이 상태 비트를 가지고 있어야 한다.
  - 다중프로세서시스템에서의 데이터 불일치 문제
    - 데이터를 여러개의 프로세서가 공유하기 때문에 서로 다른 데이터를 가져가게 될 수 있어서 문제가 발생할 수 있다. 실행결과가 달라지면 프로그램 자체적으로 큰 문제 발생.
    - write-back이 사용되는 경우
      - 1번 프로세서가 주기억장치의 X를 가져가서 연산을 한다. 2번이 또 필요해져서 주기억장치에 접속해 X를 가져가고자 할 때, 1번의 연산결과로 인해 업데이트 되기 전에 가져가버리면 전혀 엉뚱한 결과를 마주치게 된다.
      - ![Alt text](/images/9-2-1.png)
    - write-through 방식의 경우
      - 이 경우 또한 짧은 시간내에 서로 연산결과가 반영되지 않은 데이터를 접속시도 하려고 하면 문제 발생 가능
      - write-back보다는 갱신이 빠르기에 문제가 더 적게 발생할 수 있다.
- 다중 캐시(multiple cache)
  - 온-칩 캐시(on-chip cache) : 캐시 엑세스 시간을 단축시키기 위해 cpu 칩내에 포함시킨 캐시
  - 계층적 캐시
    - 온-칩 캐시를 1차(L1) 캐시로 사용하고, 칩 외부에 더 큰 용량의 2차(L2)캐시를 설치하는 방식
    - ![Alt text](/images/9-2-2.png)
    - 속도는 L1 > L2 > 주기억장치, 크기는 L1 < L2 < 주기억장치
    - L2는 L1의 슈퍼세트
      - L2의 용량이 L1보다 크며, L1의 모든 내용이 L2에도 존재
    - 먼저 L1을 검사, 없으면 L2 검사, L2에도 없으면 주기억장치 엑세스
    - 적중률은 당연히 L1보다 L2가 좀 더 높다.
      - ![Alt text](/images/9-2-3.png)
    - ![Alt text](/images/9-2-4.png)
  - 분리 캐시(split cache) : L1분리
    - 캐시를 명령어 캐시와 데이터 캐시로 분리
    - 명령어 인출 유니트와 실행 유니트 간에 캐시 엑세스 충돌 현상 제거
      - 하지만 둘 다 미스면 충돌이 날 수 있다. 즉, 완전히 제거는 못함
    - 대부분의 고속 프로세서들에서 사용, 슈퍼 스칼라같은 설계를 할 때 이를 사용함
    - ![Alt text](/images/9-2-5.png)
  - 듀얼 코어 프로세서의 캐시 구조
    - 각 코어는 별도의 L1 캐시 포함
    - L2 캐시는 두 코어에 의해 공유
    - ![Alt text](/images/9-2-6.png)
