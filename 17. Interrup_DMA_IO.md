### 인터럽트, DMA를 이용한 입출력
- 인터럽트를 이용한 입출력
  - 인터럽트 구동 IO : 인터럽트 메커니즘을 이용해, IO 동작이 진행되는 동안 CPU가 다른 작업 처리할 수 있도록 하는 방식
  - 동작 순서
    - CPU가 입출력 제어기에게 명령 전송. 다른 작업 수행
    - 제어기는 IO 장치 제어해 IO 명령 수행
    - IO 명령 수행 완료시 제어기는 CPU로 인터럽트 신호 전송
    - cpu는 인터럽트 신호 받는 즉시 원래의 프로그램으로 복귀해 수행 계속
    - ![Alt text](/images/17-0.png)
  - 인터럽트 구동 IO 구현 방법
    - 다중 인터럽트(대부분의 시스템)
      - 각 IO 제어기와 CPU사이에 별도의 인터럽트 요구선(INTR)과 인터럽트 확인선(ITNA)을 접속하는 방법
      - ![Alt text](/images/17-1.png)
        - 이와 같이 각각의 주변장치가 인터럽트를 가짐
      - 예
        - IO 제어기 #2가 인터럽트를 요구하는 경우의 동작 순서
          - IO제어기#2가 INTR2 신호 세트
          - cpu는 신호를 세트함으로써 그 제어기에게 인터럽트 요구를 인식하였음을 알리고, 인터럽트를 위한 서비스 시작
          - 제어기2는 INTR2 신호를 해제(0리셋)
          - CPU도 INTA2 신호 해제
      - 장점
        - 인터럽트 요구 장치를 쉽게 찾아냄
      - 단점
        - 하드웨어 복잡. 접속 가능 IO 장치의 수가 CPU의 인터럽트 요구 입력 핀의 수에 의해 제한
    - 데이지 체인 방식(USB 같은 경우)
      - CPU로부터 발생되는 INTA 출력 선을 IO 제어기들에 직렬로 접속
      - 인터럽트를 요구한 IO 장치는 AIn 입력을 받는 즉시 자신의 고유 번호, 즉 인터럽트 벡터를 데이터 버스를 통해 CPU로 전송
        - 인터럽트 벡터는 해당 IO 장치를 위한 인터럽트 서비스 루틴의 시작 주소를 결정하는데 사용
      - 장점
        - 하드웨어 간단
      - 단점
        - 우선순위가 낮은 장치들이 서비스를 받지 못하고 매우 오랫동안 기다려야 하는 경우 발생(starvation, 기아상태)
      - ![Alt text](/images/17-2.png)
        - CPU는 누가 요청했는지 판단할 수가 없어서 전달하는 방식으로 이용하기 때문에 우선순위가 낮으면 오래 기다려야 함.
    - 소프트웨어 폴링 방식
      - CPU가 모든 IO 제어기들에 접속된 TEST IO 선을 이용해 인터럽트를 요구한 장치를 검사하는 방식
        - Test IO 신호를 이용해 각 IO 장치의 인터럽트 플래그가 세트되어 있는 지를 검사(검사 순서가 우선순위를 결정)
      - ![Alt text](/images/17-3.png)
        - CPU가 일일이 물어보는 것.
        - 입출력 장치가 느린 경우에는 이 방식이 매우 유효함
      - 장점
        - 우선순위 변경 용이
      - 단점
        - 처리 시간 오래 걸림
- 직접기억장치엑세스(DMA : Direct Memory Access)
  - DMA : cpu의 개입없이 IO 장치와 기억장치 사이에 데이터 전송하는 방식 = 사이클 훔침(cycle stealing)
  - 방법 : cpu가 주기억장치를 엑세스하지 않는 시간 동안에 시스템 버스를 사용해 주기억장치와 io 장치 간에 데이터 전송, 즉 주변장치가 직접 버스를 통해 주기억장치 엑세스
  - ![Alt text](/images/17-4.png)
  - 처리 순서
    - CPU가 DMA 제어기로 아래 정보를 포함한 명령 전송
      - IO 장치의 주소
      - 연산 지정자
      - 데이터가 읽혀지거나 쓰여질 주기억장치 영역의 시작 주소
      - 전송될 데이터 단어들의 수
    - DMA 제어기는 CPU로 버스 요구 신호 전송
    - CPU가 DMA 제어기로 버스 승인 신호 전송
    - DMA 제어기가 주기억장치로부터 데이터 읽어서 디스크 제어기에 저장
    - 전송할 데이터 남았으면, 위 2~4번까지 반복
    - 모든 데이터들의 전송 완료시 CPU로 INTR 신호 전송
  - 문제점
    - 각 데이터 전송 때마다 시스템 버스 두 번씩 사용(버스 사용량 증가. 시스템 성능 저하)
    - 해결책
      - IO 장치들을 DMA 제어기에 접속
      - IO 버스 사용(계층적으로 외부 입출력 버스를 제어기에 연결해 내부 버스를 사용하지 않는 것)
    - Io 장치는 종류와 속도가 다양해 제어 방법이 복잡하므로, 간단한 구조 가진 DMA 제어기로는 한계가 있다., 디스크 쓰기/읽기 동작의 경우 데이터 블록의 크기가 512 바이트 이상이라 해당 데이터를 버퍼링하기 위한 내부 기억장치 필요
    - 해결책
      - IO 프로세서(IOP)사용 - IO 채널이라고도 함
      - ![Alt text](/images/17-5.png)
